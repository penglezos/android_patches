From 4226fdf004511d85e693e1f53646b7493de92fd2 Mon Sep 17 00:00:00 2001
From: penglezos <panagiotisegl@gmail.com>
Date: Fri, 5 May 2023 19:45:24 +0300
Subject: [PATCH 2/2] udfps: Disable Extra Dim on keyguard

Change-Id: I4858971734c72099bd90476a6a0a7a7d49a6b593
Signed-off-by: penglezos <panagiotisegl@gmail.com>
---
 .../com/android/systemui/biometrics/UdfpsController.java  | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/packages/SystemUI/src/com/android/systemui/biometrics/UdfpsController.java b/packages/SystemUI/src/com/android/systemui/biometrics/UdfpsController.java
index 9705d244f8ff..9a54d703e88d 100644
--- a/packages/SystemUI/src/com/android/systemui/biometrics/UdfpsController.java
+++ b/packages/SystemUI/src/com/android/systemui/biometrics/UdfpsController.java
@@ -187,6 +187,7 @@ public class UdfpsController implements DozeReceiver, Dumpable {
     private boolean mAttemptedToDismissKeyguard;
     private final Set<Callback> mCallbacks = new HashSet<>();
     private boolean mNightDisplayEnabled;
+    private boolean mExtraDimEnabled;
 
     @VisibleForTesting
     public static final VibrationAttributes UDFPS_VIBRATION_ATTRIBUTES =
@@ -836,6 +837,10 @@ public class UdfpsController implements DozeReceiver, Dumpable {
         if (mNightDisplayEnabled) {
             mColorDisplayManager.setNightDisplayActivated(false);
         }
+        mExtraDimEnabled = mColorDisplayManager.isReduceBrightColorsActivated();
+        if (mExtraDimEnabled) {
+            mColorDisplayManager.setReduceBrightColorsActivated(false);
+        }
         mExecution.assertIsMainThread();
 
         mOverlay = overlay;
@@ -860,6 +865,9 @@ public class UdfpsController implements DozeReceiver, Dumpable {
         if (mNightDisplayEnabled) {
             mColorDisplayManager.setNightDisplayActivated(true);
         }
+        if (mExtraDimEnabled) {
+            mColorDisplayManager.setReduceBrightColorsActivated(true);
+        }
         mExecution.assertIsMainThread();
 
         if (mOverlay != null) {
-- 
2.40.1

