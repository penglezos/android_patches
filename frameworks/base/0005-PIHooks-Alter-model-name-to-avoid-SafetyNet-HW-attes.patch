From 7beec50726ea499058a729b368967142becd91d8 Mon Sep 17 00:00:00 2001
From: Danny Lin <danny@kdrag0n.dev>
Date: Fri, 14 Oct 2022 09:53:12 +0200
Subject: [PATCH 2/3] PIHooks: Alter model name to avoid SafetyNet HW
 attestation

As of September 2, Google is enforcing SafetyNet's previously
opportunistic hardware-backed attestation based on device information.
Append a space to the device model name in order to avoid such
enforcement.

Change-Id: Ib7779e0aae40cab3730a56785e9231896917ab0a
[ghostrider-reborn: adapt to PIHooks, use invisible space]
Signed-off-by: Adithya R <gh0strider.2k18.reborn@gmail.com>
---
 .../com/android/internal/util/PropImitationHooks.java     | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/core/java/com/android/internal/util/PropImitationHooks.java b/core/java/com/android/internal/util/PropImitationHooks.java
index cecca63b4b83..7799d51171c2 100644
--- a/core/java/com/android/internal/util/PropImitationHooks.java
+++ b/core/java/com/android/internal/util/PropImitationHooks.java
@@ -56,9 +56,13 @@ public class PropImitationHooks {
         sIsGms = packageName.equals(PACKAGE_GMS) && processName.equals(PROCESS_GMS_UNSTABLE);
         sIsFinsky = packageName.equals(PACKAGE_FINSKY);
 
-        if (!sCertifiedFp.isEmpty() && (sIsGms || sIsFinsky)) {
-            dlog("Setting certified fingerprint for: " + packageName);
+        /* Set Certified Fingerprint for GMSCore or Finsky
+         * Set Stock Fingerprint for ARCore
+         */
+        if (!sCertifiedFp.isEmpty() && sIsGms) {
+            dlog("Spoofing build for GMS");
             setPropValue("FINGERPRINT", sCertifiedFp);
+            setPropValue("MODEL", Build.MODEL + "\u200b");
         } else if (!sStockFp.isEmpty() && packageName.equals(PACKAGE_ARCORE)) {
             dlog("Setting stock fingerprint for: " + packageName);
             setPropValue("FINGERPRINT", sStockFp);
-- 
2.39.1

